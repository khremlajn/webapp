machine:
  python:
    version: 2.7.9
  services:
    - docker
dependencies:
  post:
    - docker build --rm=false -t webapp .
test:
  override:
    - exit 0
deployment:
  prod:
    branch: master
    commands:
      - autorization_token=$(aws ecr get-authorization-token --registry-ids 792082350620 --output text --query authorizationData[].authorizationToken | base64 --decode | cut -d: -f2)
      - docker login -u AWS -p $autorization_token -e none https://792082350620.dkr.ecr.us-west-2.amazonaws.com
      - docker tag webapp-repository:latest 792082350620.dkr.ecr.us-west-2.amazonaws.com/webapp-repository:latest
      - docker push 792082350620.dkr.ecr.us-west-2.amazonaws.com/webapp-repository
